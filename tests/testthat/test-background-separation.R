
test_that("SeparateSignatureFromBackground", {
  set.seed(1099,"L'Ecuyer-CMRG")
  
  spectra <- example.spectra[["MCF10A.cisplatin"]]
  
  spectra.catalog.type <- attr(spectra, "catalog.type", exact = TRUE)
  if (is.null(spectra.catalog.type)) {
    warning("is.null(spectra.catalog.type)")
  }
  
  retval <- 
    SeparateSignatureFromBackground(
      spectra     = spectra,
      bg.sig.info = background.info[["MCF10A"]],
      m.opts      = NULL,
      start.b.fraction = 0.5)
  
  expected.sig <-
    c(0.00521663864019093, 0.0252124997136492, 0.000689866645300827,
      0.0128458707465942, 0.0146139683984744, 0.00822863158250983,
      0.000734435584127253, 0.0280175417628801, 0.0165238306686777,
      0.0649260394030582, 0.00101383326485888, 0.00741648552072589,
      0.00640928715606261, 0.0132286479797023, 0.00057878908142809,
      0.0167581746483631, 0.00260599405209982, 0.00262179990876024,
      0.000508658568666244, 0.00523235909086705, 0.00280218079238442,
      0.00258207569755989, 0.000710458956889611, 0.00802836147375991,
      0.00270814544203649, 0.0343063079602962, 5.28088717009954e-08,
      0.00762967385806394, 0.00508490049889709, 0.00380397642617103,
      0.000451843950653232, 0.0235981211381199, 0.00244169411888149,
      0.00198564771111378, 0.000620186420908281, 0.0022741258995734,
      0.0322521904816754, 0.113675874605877, 0.00849813711803662,
      0.100405984575479, 0.00751394501857976, 0.0138848770857111,
      0.00103266480553855, 0.00558133524438192, 0.0053019006564399,
      0.0182093559479432, 0.00144261131893888, 0.0219418553336703,
      0.00445949275649771, 0.00718681918408359, 0.00266677845348703,
      0.00578536992740132, 0.0384650846264653, 0.0293023264658698,
      0.0457845846730764, 0.0432659294248153, 0.00151978585547319,
      0.00406118528859738, 0.00144315731369951, 0.000915067721383537,
      0.00308289804800188, 0.00218337720260332, 0.00149339560229532,
      0.00255874226503259, 0.00501432170350539, 0.00346090645401816,
      0.00213629196001318, 0.00345506556621283, 0.00660248148173835,
      0.0117196308049753, 0.0101671711045763, 0.0179305060228415, 
      0.00237353597468839, 0.0144841479405917, 0.00121758340995426,
      0.000951837217043188, 0.004049630262582, 0.00375331265121165,
      0.00162481710744591, 0.00211458510834088, 0.00230898862961891,
      0.00117097329005044, 0.00346666854978738, 0.00147542791531851, 
      0.00257621452565193, 0.00325221579402504, 0.00598259131994251, 
      0.00348879342720499, 0.000983019659937142, 0.00583834659343522,
      0.00991267923908797, 0.00188440518721224, 0.00277325147085678,
      0.00140439064500905, 0.00439169176835837, 0.00170868464253258)
    
  testthat::expect_equal(retval$inferred.target.sig, expected.sig,
                         tolerance = 1e-4)
})
